\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{siunitx}
\usepackage{color}

\newcommand{\pd}{\partial}

\title{Non-dimensional Setup for Schrodinger-Poisson system}
\author{Boris Zupancic}
\date{June 2022}

\begin{document}

\maketitle

\section{Fuzzy Dark Matter (FDM)}
The Schrodinger-Poisson (SP) system in a 1D periodic box is
\begin{equation}
    \begin{cases}
    i\hbar \frac{\pd \psi}{\pd t} = -\frac{\hbar^2}{2m}\frac{\pd^2 \psi}{\pd x^2} + m\Phi \psi 
    \\
    \frac{\pd^2 \Phi}{\pd x^2} = 4\pi G \rho= 4\pi G m (|\psi|^2 - \langle |\psi|^2 \rangle)
    \end{cases}
    \label{SP}
\end{equation}
where $\hbar$ is the reduced Planck's constant, $m$ is the FDM-particle mass, $\Phi$ is the specific gravitational potential, and $\psi$ is the wave-function such that the density takes the form:
$$\rho = m|\psi|^2$$
Thus $|\psi|^2$ is interpreted as a number density.

To non-dimensionalize, we would like length, velocity, time and mass scales, $L, v,T,M$, such that
\begin{equation}
    \begin{cases}
    \Phi = v^2 \varphi\\
    \psi = L^{-3/2} \chi\\
    x = L z\\
    t = T \tau\\
    m = M \mu
    \end{cases}
    \label{Substitutions}
\end{equation}
To illustrate, let us fix length and velocity scales $L$ and $v$, respectively. For example, we may take:
$$L = \SI{1}{kpc} $$
$$v = \SI{100}{km.s^{-1}}$$
and then define a time scale 
$$T  = \frac{L}{v}$$
We may define a mass scale by first setting Newton's constant to unity $G = 1$, then:
$$[G] = M^{-1} L^3 T^{-2} \Rightarrow M \equiv \frac{L^3}{T^2} = v^2 L$$

We may further define a "fuzziness" parameter 
$$r \equiv \frac{\hbar}{2 m v L}$$
and finally substituting (\ref{Substitutions}) along with $r$ into Equation (\ref{SP}):

\begin{equation}
    \begin{cases}
    i\frac{\pd \chi}{\pd \tau} = -r\frac{\pd^2 \chi}{\pd z^2} + \frac{1}{2r}\varphi\chi \\
    
    \frac{\pd^2 \varphi}{\pd z^2} = 4\pi\mu (\chi\chi^* - \langle\chi\chi^*\rangle)
    \end{cases}
    \label{SP-NonDim}
\end{equation}

\section{Particles}
In the particle scenario, the equation of motion is the familiar form of Newton's second law, where for a single particle with position $x$ in a gravitational potential $U = m\Phi$:
$$\frac{d^2 x}{d t^2} = -\nabla\Phi = -\frac{\pd}{\pd x}\Phi(x,t)$$
Substituting the same dimensionless parameters (\ref{Substitutions}) as in the wave scenario:
$$\frac{d^2 z}{d\tau^2} = -\frac{\pd \varphi}{\pd z}$$

The gravitational potential is again given by Poisson's equation, and the particle density is 
\begin{equation}
\rho = n \cdot m_{\text{part}}
\label{Particle density}
\end{equation}

where $n$ is the volumetric number density and $m_{\text{part}}$ is the particle mass.

\section{1D Numerical Schemes}

\subsection{Initial Setup}
The system is setup on a grid of $N$ linearly spaced points:
$$z = [z_0, z_1, z_2, ..., z_{N-1}]$$
(indexing starts with \texttt{i = 0} in Python3). These values will serve as edges for histogramming positions of particles, and positions at which the density, potential and acceleration fields are defined. The width of the bins is the constant
$$dz = z_{i+1} - z_i$$

The choice of $N$ will determine the accuracy of the FFT Poisson Solver described below; a higher value $N$ will both increase the accuracy, and increase the computational cost. 

In any given simulation, we further define the box width $L$, and apply the boundaries:
\begin{align}
    z_0 &= -L/2 \\ 
    z_{N-1} &= L/2
\end{align}

%\subsubsection{FDM}

%\subsubsection{Particles}

\subsubsection{Initial Conditions}
Our goal is to now setup an initial distribution of FDM and/or particles.

To create these initial conditions, a collection of particles is generated from a random gaussian distribution centered at 
$$z_\text{center} = \frac{z_0 -z_{N-1}}{2} $$
Each particle is given an initial velocity of zero: $v = 0$.

\subsubsection{Calculating Particle Density}
At any given time step of a simulation, it is necessary to calculate the acceleration field defined on the grid. To do this, density must be calculated first. Following Equation (\ref{Particle density}), in our numerical scheme, the density in a given bin of length $d L_\text{box}$ will be:

\begin{equation}
\rho_k = \frac{N_k}{d L_\text{box}}\cdot \Sigma
\label{Numerical Particle Density}
\end{equation}
where $N_k$ is the number of particles counted in the $k^\text{th}$ bin, and $\Sigma$ is the mass per unit area defined for each particle. Note here that $\Sigma$ must have the specified dimensions in the 1D scenario, as each particle is really treated as an infinite 2D sheet perpendicular to our grid $z$. 

To retrieve a non-dimensional measure for density, we must consider again our scales. The values above may be written as:
\begin{equation*}
    \begin{cases}
    d L_\text{box} = L dz \\
    \Sigma = \frac{M}{L^2} \sigma
    \end{cases}
\end{equation*}
where $\sigma$ is a newly defined non-dimensional analogue for the mass (per unit area) of each particle. Substitution of these values into (\ref{Numerical Particle Density}) yields a newly defined (non-dim.) density:
$$\mu_k \equiv \frac{L^3}{M} \rho_k = \frac{N_k}{dz}\sigma$$

\subsubsection{Poisson's Equation for Particles}
In the dimensional case, Poisson's equation always looks like:
\begin{equation*}
    \nabla_x^2 \Phi = 4\pi G (\rho - \langle \rho \rangle) 
\end{equation*}

When we make the substitutions $\Phi = v^2 \varphi$ and $\rho_k = \frac{N_k}{dL_{box}}\cdot \Sigma$, we get:
\begin{equation*}
    \frac{v^2}{L^2}\frac{\pd^2 \varphi}{\pd z^2} = 4\pi \frac{M}{L^3} \left( \frac{n_k}{\Delta z}\cdot \sigma - \left\langle \frac{n_k}{\Delta z}\cdot \sigma \right\rangle\right)
\end{equation*}
Which reduces to
\begin{equation}
    \frac{\pd^2 \varphi}{\pd z^2} = 4\pi \left( \frac{n_k}{\Delta z}\cdot \sigma - \left\langle \frac{n_k}{\Delta z}\cdot \sigma \right\rangle\right)
\end{equation}


\end{document}


